#!/bin/bash
#
#  This file is part of the Jikes RVM project (http://jikesrvm.org).
#
#  This file is licensed to You under the Common Public License (CPL);
#  You may not use this file except in compliance with the License. You
#  may obtain a copy of the License at
#
#      http://www.opensource.org/licenses/cpl1.0.php
#
#  See the COPYRIGHT.txt file distributed with this work for information
#  regarding copyright ownership.
#

# JDB and JikesRVM setup script.  This is to provide the specialized
# JDB for the JikesRVM, and the user should not have any problem if
# the user has experience with the JDB.

function usage() {
cat <<EOF
Usage: ${0##*/} <options> <class> <arguments>
 JikesRVM jdb launcher

where options include:
    -help                   print this message and exit
    -jdwpverbose <level>    JDWP agent's verbose level

options forward to the jdb: 
    -sourcepath <directories separated by ":">
    -dbgtrace
    -tclient
    -tserver

Try "jdb -help" for more information. The remaining <class> and
<arguments> are forwared to the jdb

EOF
    exit -1
}

# consume JDB options
JDB_OPTIONS=""
JDWP_VERVOSE=0
while (($# > 0));do
    case $1 in
	-help) usage;;
	-sourcepath) 
	    if (( $# > 1));then JDB_OPTIONS="${JDB_OPTIONS} $1 $2"; else usage;fi
	    shift ;;
	-jdwpverbose)
	    if (( $# > 1));then JDWP_VERVOSE="$2"; else usage;fi
	    shift ;;
	-dbgtrace | -tclient | -tserver )
	    JDB_OPTIONS="${JDB_OPTIONS} $1";;
	*) break;;
    esac
    shift
done

if (( $# == 0 ));then
    usage
fi

RVMCMD="rvm \"-Xrunjdwp:verbose=${JDWP_VERVOSE},transport=dt_socket,address=8000,suspend=y\" $*"
CONNECT="com.sun.jdi.RawCommandLineLaunch:command=${RVMCMD},address=8000"
exec jdb ${JDB_OPTIONS} -launch -connect "${CONNECT}"
